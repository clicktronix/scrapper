# PRD: Таксономия, теги и семантический поиск блогеров

Дата: 2026-02-23

---

## 1. Контекст и цели

Платформа для инфлюенсер-маркетинга. Рекламодатели ищут блогеров для коллабораций.

**Текущее состояние:** 11 категорий, 4 тестовых тега, embedding не заполняется, поиск только через AI-чат.

**Цель:** трёхуровневая таксономия (категория → подкатегория → теги), семантический поиск через embedding, UI-каталог с фильтрами.

**Язык:** весь контент и поиск на русском языке.

---

## 2. Таксономия: категории и подкатегории

### 2.1. Структура

Двухуровневая иерархия в таблице `categories` с `parent_id`. AI выбирает из фиксированного списка (не свободный текст).

- У блога **одна primary** категория и **до 5 secondary** подкатегорий
- Подкатегории включают профессии (визажисты, врачи, юристы и т.д.)

### 2.2. Категории (20 шт) и подкатегории (~120 шт)

| # | Код | Категория | Подкатегории |
|---|-----|-----------|--------------|
| 1 | `beauty` | Красота | Макияж, Уход за кожей, Волосы, Ногти, Парфюмерия, Барберинг, Визажисты, Стилисты, Косметологи |
| 2 | `fashion` | Мода | Женская одежда, Мужская одежда, Обувь и кроссовки, Аксессуары и украшения, Streetwear, Luxury, Дизайнеры одежды, Модели, Имидж-консультанты |
| 3 | `fitness` | Фитнес и спорт | Тренировки и зал, Йога и пилатес, Бег, Единоборства, Спортивное питание, Конкретные виды спорта, Тренеры, Спортсмены, Нутрициологи |
| 4 | `food` | Еда и кулинария | Рецепты, Рестораны и кафе, ПП и диеты, Выпечка, Национальная кухня, Веган, Повара и шеф-повара, Кондитеры |
| 5 | `travel` | Путешествия | По Казахстану, СНГ, Европа и мир, Бюджетные, Luxury-путешествия, Гиды и экскурсоводы, Тревел-фотографы |
| 6 | `lifestyle` | Лайфстайл | Повседневная жизнь, Мотивация и саморазвитие, Минимализм, Коучи, Спикеры |
| 7 | `family` | Семья и дети | Материнство, Отцовство, Беременность, Детское развитие, Подростки, Педагоги, Детские психологи, Логопеды |
| 8 | `health` | Здоровье | Медицина, Психология, ЗОЖ, Врачи, Стоматологи, Дерматологи, Психотерапевты, Диетологи, Фармацевты |
| 9 | `tech` | Технологии | Гаджеты и обзоры, Софт и приложения, AI и нейросети, IT-специалисты, Разработчики, Тестировщики |
| 10 | `business` | Бизнес | Предпринимательство, Маркетинг и SMM, Финансы и инвестиции, Карьера, Крипто, Юристы, Бухгалтеры, HR-специалисты, Риэлторы |
| 11 | `education` | Образование | Языки, Школьное и вузы, Онлайн-курсы, Наука, Книги, Учителя, Репетиторы, Профессора |
| 12 | `entertainment` | Развлечения | Юмор и скетчи, Челленджи, Пранки, Мемы, Стендап, Комики, Актёры, Аниматоры |
| 13 | `music` | Музыка | Исполнители, DJ, Каверы, Музыкальное образование, Музыканты, Продюсеры, Вокальные тренеры |
| 14 | `gaming` | Игры | Видеоигры, Стриминг, Киберспорт, Мобильные игры, Стримеры, Киберспортсмены |
| 15 | `art` | Искусство | Фотография, Живопись и иллюстрация, Дизайн, Кино и сериалы, Танцы, Фотографы, Художники, Графические дизайнеры, Хореографы |
| 16 | `home` | Дом и интерьер | Дизайн интерьера, Ремонт и строительство, DIY, Сад и огород, Архитекторы, Дизайнеры интерьера, Прорабы |
| 17 | `auto` | Авто и мото | Обзоры авто, Тюнинг, Мотоциклы, Электромобили, Автомеханики, Автоэксперты |
| 18 | `pets` | Животные | Собаки, Кошки, Экзотические, Ветеринары, Грумеры, Кинологи |
| 19 | `realestate` | Недвижимость | Квартиры, Загородное, Аренда, Обзоры ЖК, Застройщики |
| 20 | `esoteric` | Эзотерика и духовность | Астрология, Таро, Психологические практики, Религия, Астрологи, Тарологи |

### 2.3. Изменения в БД

Таблица `categories` — добавить `parent_id`:

```sql
ALTER TABLE categories ADD COLUMN parent_id UUID REFERENCES categories(id);
-- parent_id = NULL → верхнеуровневая категория
-- parent_id = <uuid> → подкатегория
```

AI получает полный список в промпте и выбирает коды.

---

## 3. Теги (200+ характеристик)

### 3.1. Принципы

- Гибрид: базовый справочник 200+ тегов + AI может предложить новые
- Новые теги AI попадают в статус `unconfirmed` до модерации
- Теги покрывают 6 измерений: контент, личность, профессиональное, коммерция, аудитория, маркетинг
- Один блогер получает 15-40 тегов при анализе

### 3.2. Изменения в БД

Таблица `tags` — добавить `group` и `status`:

```sql
ALTER TABLE tags ADD COLUMN "group" TEXT NOT NULL DEFAULT 'content'
  CHECK ("group" IN ('content', 'personal', 'professional', 'commercial', 'audience', 'marketing'));
ALTER TABLE tags ADD COLUMN status TEXT NOT NULL DEFAULT 'active'
  CHECK (status IN ('active', 'unconfirmed'));
```

### 3.3. Группа 1: Контент и формат (~40 тегов)

**Формат контента:**
`видео-контент`, `фото-контент`, `reels`, `карусели`, `сторис-контент`, `прямые эфиры`, `подкасты`, `лонгриды`, `shorts`

**Стиль подачи:**
`юмор`, `эстетика`, `образовательный`, `мотивационный`, `провокационный`, `разговорный`, `сторителлинг`, `до/после`, `обзоры`, `распаковки`, `ASMR`, `влог`, `туториалы`, `лайфхаки`, `рецензии`, `интервью`, `коллаборации`, `челленджи`

**Качество:**
`профессиональная съёмка`, `студийный свет`, `мобильная съёмка`, `монтаж`, `анимация`, `графика`, `единый визуальный стиль`

**Частота и активность:**
`ежедневный постинг`, `несколько раз в неделю`, `еженедельный`, `нерегулярный`, `высокая вовлечённость аудитории`, `активно отвечает на комментарии`

### 3.4. Группа 2: Личность и демография (~45 тегов)

**Пол и возраст:**
`женщина`, `мужчина`, `18-24`, `25-34`, `35-44`, `45+`

**Семья:**
`замужем/женат`, `в отношениях`, `мама`, `папа`, `мама двоих детей`, `мама троих+`, `многодетная семья`, `молодая мама`, `беременна`, `дети-младенцы`, `дети-школьники`, `дети-подростки`

**Образ жизни:**
`премиум-образ жизни`, `luxury`, `средний класс`, `бюджетный образ жизни`, `минималист`, `путешествует часто`, `домосед`, `активный образ жизни`, `ЗОЖ`

**Авто и имущество:**
`автовладелец`, `бюджетное авто`, `премиум авто`, `luxury авто`, `мотоцикл`, `владелец недвижимости`, `арендатор`

**Питомцы:**
`собака`, `кошка`, `экзотические животные`, `несколько питомцев`

**Локация:**
`Алматы`, `Астана`, `Шымкент`, `Москва`, `Дубай`, `Стамбул`, `живёт за границей`, `релокант`, `цифровой кочевник`

### 3.5. Группа 3: Профессиональное и экспертиза (~30 тегов)

**Статус:**
`эксперт в нише`, `сертифицированный специалист`, `дипломированный`, `практикующий специалист`, `преподаватель`, `автор курсов`, `автор книги`, `спикер`, `менторство`

**Языки:**
`русский`, `казахский`, `английский`, `двуязычный`, `многоязычный`, `постит на русском`, `постит на казахском`

**Управление:**
`есть менеджер`, `есть агентство`, `самостоятельное управление`, `есть ассистент`

**Мультиплатформенность:**
`Instagram`, `TikTok`, `YouTube`, `Telegram`, `VK`, `мультиплатформенный`

### 3.6. Группа 4: Коммерция и реклама (~35 тегов)

**Размер:**
`нано (до 10K)`, `микро (10-100K)`, `мид (100K-500K)`, `макро (500K-1M)`, `мега (1M+)`, `селебрити`

**Рекламная активность:**
`активный рекламодатель`, `редко рекламирует`, `не рекламирует`, `открыт к бартеру`, `только за оплату`

**Форматы рекламы:**
`интеграции`, `выделенные посты`, `сторис-реклама`, `reels-реклама`, `обзоры продуктов`, `распаковки`, `амбассадорство`, `прямые эфиры с брендом`

**Коммерческие индустрии (что рекламирует):**
`рекламирует косметику`, `рекламирует одежду`, `рекламирует еду`, `рекламирует авто`, `рекламирует недвижимость`, `рекламирует банки/финтех`, `рекламирует детские товары`, `рекламирует путешествия`, `рекламирует электронику`

**Собственный продукт:**
`свой бренд одежды`, `свой курс`, `свой магазин`, `свой ресторан/кафе`, `свой бьюти-салон`, `свой мерч`, `реферальные ссылки`

### 3.7. Группа 5: Аудитория (~25 тегов)

**Демография аудитории:**
`аудитория женская`, `аудитория мужская`, `аудитория смешанная`, `аудитория 18-24`, `аудитория 25-34`, `аудитория 35-44`, `аудитория 45+`

**Гео аудитории:**
`аудитория Казахстан`, `аудитория Россия`, `аудитория Узбекистан`, `аудитория СНГ`, `аудитория международная`

**Качество:**
`органическая аудитория`, `подозрительная активность`, `высокая вовлечённость`, `лояльное комьюнити`, `положительные комментарии`, `токсичные комментарии`

**Доход аудитории:**
`аудитория low-income`, `аудитория middle-income`, `аудитория high-income`, `аудитория premium`

### 3.8. Группа 6: Маркетинговая ценность (~30 тегов)

**Подходит для индустрий:**
`подходит для beauty-брендов`, `подходит для fashion`, `подходит для FMCG`, `подходит для tech`, `подходит для авто`, `подходит для банков`, `подходит для HoReCa`, `подходит для фарма`, `подходит для детских брендов`, `подходит для travel`, `подходит для e-commerce`, `подходит для luxury`

**Не подходит для:**
`не подходит для алкоголя`, `не подходит для политики`, `не подходит для азартных игр`, `не подходит для 18+`, `не подходит для табака`

**Риски и репутация:**
`низкий риск`, `средний риск`, `brand safe`, `были скандалы`, `спорные высказывания`

**Ценности:**
`семейные ценности`, `экология`, `феминизм`, `инклюзивность`, `благотворительность`, `патриотизм`, `позитив`, `честность и прозрачность`

---

## 4. Embedding и семантический поиск

### 4.1. Состав embedding-вектора

Вектор строится из структурированного русскоязычного текста после AI-анализа:

```
{short_label}. {short_summary}

Категория: {primary_category}. Подкатегории: {subcategories}.
Профессия: {profession}. Город: {city}. Языки: {languages}.
Тип аккаунта: {page_type}.

Теги: {все теги блогера через запятую}.

Аудитория: {audience_gender}, {audience_age}, {audience_geo}.
Интересы аудитории: {audience_interests}.

Подходит для рекламы: {best_fit_industries}.
Не подходит: {not_suitable_for}.
Рекламирует: {detected_brand_categories}.
```

**Модель:** OpenAI `text-embedding-3-small` (1536 dim), хорошо работает с русским.

### 4.2. Пример embedding-текста

```
Юмор-блогер. Популярный блогер из СНГ, снимает развлекательные видео
и бытовые сценки, коллаборации с брендами.

Категория: Развлечения. Подкатегории: Юмор и скетчи, Лайфстайл, Путешествия.
Профессия: блогер. Языки: русский.
Тип аккаунта: личный блог.

Теги: видео-контент, reels, юмор, сторителлинг, коллаборации,
мужчина, 25-34, путешествует часто, активный рекламодатель,
интеграции, макро (500K-1M), органическая аудитория,
аудитория смешанная, аудитория СНГ, положительные комментарии,
семейные ценности, позитив, brand safe, низкий риск.

Аудитория: смешанная, mixed, СНГ.
Интересы аудитории: юмор, развлечение, путешествия, семья.

Подходит для рекламы: lifestyle, travel, FMCG, entertainment.
Не подходит: finance, healthcare, politics.
Рекламирует: consumer_goods, travel, retail, entertainment.
```

### 4.3. Когда генерируется embedding

```
full_scrape → ai_analysis (batch) → save ai_insights + tags → generate embedding → save blogs.embedding
```

Добавляется в конец хэндлера `ai_analysis`. Один вызов OpenAI Embeddings API (~$0.00001).

### 4.4. Два режима поиска

**Режим 1 — AI-агент (чат):**

```
Запрос: "Найди бьюти-блогеров из Алматы для рекламы корейской косметики, бюджет до 200К"

Агент извлекает:
  query → embedding ("бьюти-блогер Алматы корейская косметика")
  filters → { category: "beauty", city: "Алматы", max_price: 200000 }

→ RPC match_blogs(embedding, filters) → cosine similarity + фильтры
```

**Режим 2 — UI-каталог (фильтры):**

```
Пользователь выбирает в UI:
  Категория: Красота → Подкатегория: Визажисты
  Теги: [корейская косметика]
  Город: Алматы
  Подписчики: 50K-500K, ER: от 3%

→ SQL JOIN blog_categories, blog_tags, blogs WHERE ...
→ Без embedding — чисто фильтрация
```

### 4.5. Обновление RPC `match_blogs`

Добавить параметры:

| Параметр | Тип | Описание |
|----------|-----|----------|
| `filter_subcategory` | `text` | Код подкатегории (ILIKE) |
| `filter_tags` | `uuid[]` | Массив ID тегов (блог должен иметь ВСЕ указанные теги) |
| `filter_page_type` | `text` | blog / public / business |

---

## 5. Изменения в AI-схеме (AIInsights)

### 5.1. Новые поля

```python
class AIInsights(BaseModel):
    short_label: str = ""          # НОВОЕ: 2-3 слова ("семейный блогер", "фуд-блогер")
    short_summary: str = ""        # НОВОЕ: 2-3 строки краткое описание
    summary: str = ""              # Уже есть: 2-3 абзаца
    tags: list[str] = []           # НОВОЕ: список тегов из справочника
    ...
```

### 5.2. Изменения в blogger_profile

```python
class BloggerProfile(BaseModel):
    ...
    has_manager: bool | None = None       # НОВОЕ
    manager_contact: str | None = None    # НОВОЕ
    country: str | None = None            # НОВОЕ
```

### 5.3. Изменения в commercial

```python
class CommercialActivity(BaseModel):
    ...
    ambassador_brands: list[str] = []     # НОВОЕ
```

### 5.4. Промпт

AI получает в промпте:
- Фиксированный список категорий и подкатегорий (20 + ~120)
- Фиксированный список тегов (200+) с группами
- Инструкцию: выбирать из списка, предлагать новые только если нет подходящего

---

## 6. Gap-анализ vs ожидания продукта

### 6.1. Идентификация

| Поле | Статус | Решение |
|------|--------|---------|
| ID, username, ФИО, верификация | ЕСТЬ | — |
| Гео (город + страна) | ЧАСТИЧНО | AI заполняет country, привязка к blog_cities |
| Email, телефон, ссылки в bio | ЕСТЬ | — |
| Профессия | ЕСТЬ | `ai_insights.blogger_profile.profession` |
| Язык контента | ЕСТЬ | `ai_insights.content.content_language` |
| Менеджер/агентство | **НЕТ** | Добавить `has_manager` в AIInsights |
| Категория аккаунта | ЕСТЬ | `page_type` (blog/public/business) |

### 6.2. Метрики

| Поле | Статус | Решение |
|------|--------|---------|
| Подписчики, ER, ERR | ЕСТЬ | — |
| Средние просмотры рилсов | **НЕТ** | Добавить `avg_reels_views` в blogs, считать при скрапе |
| Лайки, комментарии (per-post) | ЕСТЬ | — |
| Шеры, сохранения | **НЕТ** | Невозможно без Instagram Insights API |

### 6.3. Контент ДНК

| Поле | Статус | Решение |
|------|--------|---------|
| Кратко 2-3 слова | **НЕТ** | `short_label` в AIInsights |
| Кратко 2-3 строки | **НЕТ** | `short_summary` в AIInsights |
| Подробно 2-3 абзаца | ЕСТЬ | `summary` |
| Категория (ниша) | ЕСТЬ (проблема матчинга) | AI выбирает из фиксированного списка |
| Подкатегории до 5 шт | ЕСТЬ (та же проблема) | AI выбирает из фиксированного списка |
| Теги 200+ | **НЕТ** | Справочник + AI присваивает |

### 6.4. Аудитория

| Поле | Статус | Решение |
|------|--------|---------|
| Гео, возраст, пол аудитории | ЧАСТИЧНО (enum) | Оставить как есть — точные данные невозможны без Insights API |
| Качество аудитории | ЧАСТИЧНО | `engagement_quality` enum + теги |
| Интересы аудитории | ЕСТЬ | `audience_interests` массив |
| Токсичность / сообщество | **НЕТ** | P2 — через теги |

### 6.5. Рекламодатели и бренд-сейфти

| Поле | Статус | Решение |
|------|--------|---------|
| Подходит / не подходит для | ЕСТЬ | `best_fit_industries`, `not_suitable_for` |
| Бренды и категории | ЕСТЬ | `detected_brands`, `detected_brand_categories` |
| Амбассадорство | **НЕТ** | `ambassador_brands` в AIInsights |
| Brand safety | ЕСТЬ (часто null) | Улучшить промпт |
| СМИ-мониторинг | **НЕТ** | P2 — внешний API |

---

## 7. Текущие схемы БД

### Основные таблицы

```
blogs               — профили (id, username, followers_count, ai_insights jsonb, embedding vector(1536), ...)
blog_posts          — публикации (like_count, comment_count, play_count, sponsor_brands, ...)
blog_highlights     — хайлайты (story_sponsor_tags, has_paid_partnership, ...)
blog_categories     — blog ↔ category M2M (is_primary)
blog_tags           — blog ↔ tag M2M
blog_cities         — blog ↔ city M2M
blog_prices         — blog ↔ price_type M2M (amount)
```

### Справочные таблицы

```
categories (11 → 20+120)  — id, code, name, color, parent_id (НОВОЕ)
tags (4 → 200+)           — id, name, color, group (НОВОЕ), status (НОВОЕ)
cities (117)               — id, name, country_code, l10n, ...
price_types (6)            — id, code, name, platforms, category, is_primary
persons                    — id, full_name, manager_contact, gender
```

### AI Insights (обновлённая схема)

```
AIInsights
├── short_label: str                     — НОВОЕ: 2-3 слова
├── short_summary: str                   — НОВОЕ: 2-3 строки
├── summary: str                         — 2-3 абзаца
├── tags: list[str]                      — НОВОЕ: теги из справочника
├── confidence: float
├── blogger_profile
│   ├── estimated_age, gender, city, country (НОВОЕ), profession
│   ├── education, speaks_languages, page_type
│   ├── has_manager (НОВОЕ), manager_contact (НОВОЕ)
├── life_situation (без изменений)
├── lifestyle (без изменений)
├── content
│   ├── primary_topic → выбирает из фиксированного списка категорий
│   ├── secondary_topics → выбирает из фиксированного списка подкатегорий
│   └── (остальное без изменений)
├── commercial
│   ├── ambassador_brands (НОВОЕ)
│   └── (остальное без изменений)
├── audience_inference (без изменений)
└── marketing_value (без изменений)
```

---

## 8. План реализации

### Фаза 1 — Таксономия и AI (P0)

1. Миграция: `parent_id` в categories, `group`+`status` в tags
2. Seed: 20 категорий + ~120 подкатегорий + 200+ тегов
3. Обновить AIInsights: `short_label`, `short_summary`, `tags`, `has_manager`, `country`, `ambassador_brands`
4. Обновить промпт: передавать списки категорий и тегов, AI выбирает из них
5. Обновить `match_categories` → матчинг по коду, не по имени
6. Добавить `match_tags` → upsert в blog_tags после AI-анализа
7. Генерация embedding после AI-анализа → сохранение в `blogs.embedding`
8. Добавить `avg_reels_views` в blogs, считать при скрапе

### Фаза 2 — Поиск (P1)

9. Обновить RPC `match_blogs`: `filter_subcategory`, `filter_tags`, `filter_page_type`
10. API endpoint для UI-каталога (фильтрация без embedding)
11. Обновить search tool агента для работы с тегами

### Фаза 3 — Улучшения (P2)

12. Модерация новых тегов (UI для подтверждения `unconfirmed`)
13. Привязка blog_cities
14. Расширение аудиторных данных
